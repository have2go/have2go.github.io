import{a as O,g as k,j as m,b as w,h as $,f as C,k as M,Z as U,$ as P,a0 as N,o as L,w as z,a7 as S,a2 as I,a8 as T,a3 as R,a4 as F}from"./index-W4rSxH7z.js";import{h as B}from"./render-DWWZ9kqj.js";import{l as f,L as l}from"./leaflet.draw-BndfyFCs.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D=O({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(e,{slots:n}){const{proxy:{$q:t}}=k(),a=C(M,m);if(a===m)return console.error("QPage needs to be a deep child of QLayout"),m;if(C(U,m)===m)return console.error("QPage needs to be child of QPageContainer"),m;const u=w(()=>{const p=(a.header.space===!0?a.header.size:0)+(a.footer.space===!0?a.footer.size:0);if(typeof e.styleFn=="function"){const o=a.isContainer.value===!0?a.containerHeight.value:t.screen.height;return e.styleFn(p,o)}return{minHeight:a.isContainer.value===!0?a.containerHeight.value-p+"px":t.screen.height===0?p!==0?`calc(100vh - ${p}px)`:"100vh":t.screen.height-p+"px"}}),c=w(()=>`q-page${e.padding===!0?" q-layout-padding":""}`);return()=>$("main",{class:c.value,style:u.value},B(n.default))}});f.Icon.Default.mergeOptions({iconUrl:null,iconRetinaUrl:null,shadowUrl:null,iconSize:null,iconAnchor:null,popupAnchor:null,tooltipAnchor:null,shadowSize:null,classNamePrefix:"leaflet-default-icon-"});f.Icon.Default.include({_needsInit:!0,_getIconUrl:function(e){var n=this.options.imagePath||f.Icon.Default.imagePath||"";return this._needsInit&&this._initializeOptions(n),n+f.Icon.prototype._getIconUrl.call(this,e)},_initializeOptions:function(e){this._setOptions("icon",b,e),this._setOptions("shadow",b,e),this._setOptions("popup",x),this._setOptions("tooltip",x),this._needsInit=!1},_setOptions:function(e,n,t){var a=this.options,s=a.classNamePrefix,u=n(s+e,t);for(var c in u)a[e+c]=a[e+c]||u[c]}});function b(e,n){var t=f.DomUtil.create("div",e,document.body),a=V(t),s=E(a,n),u=h(t,"width"),c=h(t,"height"),p=h(t,"margin-left"),o=h(t,"margin-top");return t.parentNode.removeChild(t),{Url:s[0],RetinaUrl:s[1],Size:[u,c],Anchor:[-p,-o]}}function x(e){var n=f.DomUtil.create("div",e,document.body),t=h(n,"margin-left"),a=h(n,"margin-top");return n.parentNode.removeChild(n),{Anchor:[t,a]}}function E(e,n){for(var t=/url\(['"]?([^"']*?)['"]?\)/gi,a=[],s=t.exec(e);s;)a.push(n?Q(s[1]):s[1]),s=t.exec(e);return a}function Q(e){return e.substr(e.lastIndexOf("/")+1)}function h(e,n){return parseInt(v(e,n),10)}function v(e,n){return f.DomUtil.getStyle(e,n)||f.DomUtil.getStyle(e,q(n))}function V(e){var n=v(e,"background-image");return n&&n!=="none"?n:v(e,"cursor")}function q(e){return e.replace(/-(\w)/g,function(n,t){return t.toUpperCase()})}const H=P({__name:"MapComponent",setup(e){const n=N();let t,a;L(()=>{t=l.map("map").setView([51.505,-.09],13),l.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(t),a=new l.FeatureGroup,t.addLayer(a);const o=new l.Control.Draw({edit:{featureGroup:a},draw:{polygon:!1,circlemarker:!1,marker:!1,circle:!1,rectangle:!1,polyline:{shapeOptions:{color:"blue"},showLength:!1}}});t.addControl(o),t.on(l.Draw.Event.CREATED,i=>{const r=i.layer;if(r instanceof l.Polyline){const g=r.getLatLngs().map(y=>[y.lat,y.lng]),d=prompt("Введите среднюю скорость (км/ч):");if(!d||isNaN(parseFloat(d))){alert("Некорректная скорость. Маршрут не добавлен.");return}const _=JSON.stringify(g);n.addRoute(parseFloat(d),_)}a.addLayer(r)}),s()});const s=()=>{if(console.log("Drawing routes..."),!t){console.error("Map is not initialized!");return}t.eachLayer(o=>{(o instanceof l.Polyline||o instanceof l.Marker)&&t.removeLayer(o)}),n.routes.forEach(o=>{const i=l.polyline(o.coordinates,{color:"blue"}).addTo(t);t.fitBounds(i.getBounds());const r=o.coordinates[0];if(!r)return;const g=l.marker(r).addTo(t);u(g,o.id,o.departureTime);const d=o.coordinates[o.coordinates.length-1];if(!d)return;const _=l.marker(d).addTo(t);c(_,o)})},u=(o,i,r)=>{const g=`
    <div>
      <label>Время отправления:</label>
      <input
        type="datetime-local"
        value="${p(r)}"
        onchange="updateDepartureTime(${i}, this.value)"
      />
    </div>
  `;o.bindPopup(g).openPopup()},c=(o,i)=>{const r=Math.max(0,i.arrivalTime.getTime()-Date.now()),g=Math.floor(r/(1e3*60*60)),d=Math.floor(r%(1e3*60*60)/(1e3*60)),_=Math.floor(r%(1e3*60)/1e3),y=`
    <div>
      <strong>Время прибытия:</strong> ${i.arrivalTime.toLocaleTimeString()}<br>
      <strong>Ср. скорость:</strong>
      <input
        type="number"
        value="${i.speed}"
        onchange="updateSpeed(${i.id}, this.value)"
      ><br>
      <strong>Осталось времени:</strong> ${g}ч ${d}мин ${_}сек<br>
      <button onclick="deleteRoute(${i.id})">Удалить маршрут</button>
    </div>
  `;o.bindPopup(y).openPopup()},p=o=>new Date(o.getTime()-o.getTimezoneOffset()*6e4).toISOString().slice(0,16);return window.updateDepartureTime=(o,i)=>{const r=new Date(i);if(isNaN(r.getTime())){alert("Некорректное значение времени отправления.");return}n.updateDepartureTime(o,r)},window.updateSpeed=(o,i)=>{const r=parseFloat(i);if(isNaN(r)||r<=0){alert("Некорректное значение средней скорости.");return}n.updateSpeed(o,r)},window.deleteRoute=o=>{n.deleteRoute(o)},z(()=>n.routes,()=>{s()},{deep:!0}),(o,i)=>(I(),S(D,{class:"flex flex-center column",style:{width:"100%"}},{default:T(()=>i[0]||(i[0]=[R("div",{id:"map",class:"map-container"},null,-1)])),_:1}))}}),X=A(H,[["__scopeId","data-v-aa5ff6fc"]]),J=P({__name:"IndexPage",setup(e){return(n,t)=>(I(),S(D,{class:"flex flex-center"},{default:T(()=>[F(X)]),_:1}))}});export{J as default};
